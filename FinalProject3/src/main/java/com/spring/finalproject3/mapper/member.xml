<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<select id="getLogin" parameterType="HashMap" resultType="com.spring.finalproject3.joseungjin.model.PersonVO">
		select perno,fk_majseq,name,gender,birthday,address,email,
				mobile,regDate,pwd,idle,identity
		from tbl_person
		where perno =#{userid} and pwd=#{pwd}
	</select>

	<select id="idFind" parameterType="HashMap" resultType="com.spring.finalproject3.joseungjin.model.PersonVO">
		select perno
		from tbl_person
		where name =#{name} and email=#{email}
	</select>
	
	<select id="pwdFind" parameterType="HashMap" resultType="com.spring.finalproject3.joseungjin.model.PersonVO">
		select perno
		from tbl_person
		where perno =#{userid} and email=#{email}
	</select>
	
	<select id="isUserExist" parameterType="HashMap" resultType="int">
		select count(*)
		from tbl_person
		where perno =#{userid} and email=#{email}
	</select>
	
	<update id="pwdUpdate" parameterType="HashMap">
		 update tbl_person set pwd = #{pwd}
 		where perno = #{userid}
	</update>
	
	<select id="personRegister" parameterType="HashMap" resultType="int">
		select count(*)
		from tbl_person
		where perno =#{userid} and name=#{name} and email=#{email} 
	</select>
	
	<select id ="MainboardView" resultType="com.spring.finalproject3.joseungjin.model.Main_index_BoardVO">
	      select B.seq, B.categoryno AS categoryno, P.name, B.subject, B.good, B.readCount,B.namecheck AS namecheck, B.commentCount,to_char(B.regDate, 'yyyy-mm-dd hh24:mi:ss') as regDate
		from tbl_board B join tbl_person P
		on B.fk_perno=P.perno
		where status=1 and good>=10
	</select>
	
	<select id ="getboardTotalPage" parameterType="HashMap" resultType="int">
		select ceil(count (*) / #{sizePerPage})
		from tbl_board
        where status=1 and good>=10
	</select>
	
	<select id ="getboardistPaging" parameterType="HashMap" resultType="com.spring.finalproject3.joseungjin.model.Main_index_BoardVO">
		  select good,seq, categoryno,name,subject,readCount,commentCount,regDate,namecheck
				from
				(
			      select row_number() over (order by  good desc) as rno,B.seq, B.categoryno, P.name AS name, B.subject, B.good, B.namecheck,B.readCount, B.commentCount,to_char(B.regDate, 'yyyy-mm-dd hh24:mi:ss') as regDate
                    from tbl_board B join tbl_person P
                    on B.fk_perno=P.perno
				where good>=10 and status = 1  
				)V
			where rno between #{startRno} and #{endRno}
	</select>
	
	<select id="Mainsubject" parameterType="int" resultType="com.spring.finalproject3.joseungjin.model.MainSubjectVO">
		select subno, fk_perno, fk_colno, subname, credit, semeter, day
		from tbl_subject
		where fk_perno = #{userid}
	</select>
</mapper>